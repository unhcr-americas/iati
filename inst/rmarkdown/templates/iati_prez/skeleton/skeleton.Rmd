---
params:
  year: 2022
  ctr_name: "El Salvador"
title: "UNHCR Programme in  \ `r params$ctr_name` "
subtitle:  "Strategic Moment of Reflection using publicly released open data"
output:
  unhcrdown::pptx_slides
---


```{r setup, include=FALSE, warning = FALSE, message = FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.cap = TRUE, warning = FALSE, message = FALSE)
library(officedown)
library(unhcrthemes)
library(ggplot2)
library(rvg)
library(tidyverse)
library(scales)
library(lubridate) 
library(fontawesome)
library(iati)
 

# fa_metadata()

# turn off the automatic use of showtext functionality, so that the dml function can works properly
showtext::showtext_auto(FALSE) 
```

#  A "Strategic Moment of Reflection" ... 

 _"is  a dedicated moment for relevant stakeholders to review progress and identify challenges, opportunities and possible strategic shifts or re-orientations"_.

This presentation conveniently includes key visualization based on [publicly released data]( `r paste0("https://reporting.unhcr.org/operational/operations/",params$ctr_name)`) on:

 * Population Statistics

 * Resources Allocation by Sector

 * Results & Indicators
 
 * Budget & Funding 

> ## “__Numbers have an important story to tell. They rely on YOU to give them a voice!__”
> -- Stephen Few


---

# How to use this slide deck?

This slide deck is long exhaustive data exploration provided as is and per default based on existing public data - in order to use it in a collective brainstorming setting, __cut it down__ - only select and retain slides that are showing elements relevant to contextualized discussion - for instance maybe no need to show each of the 16 outcomes slides...

When presenting the content, explain some important __concept for indicators__:  

 - Reported value: _what happened..._
 - Baseline value: _how it was before..._
 - Targeted value: _how it was planned to become..._
 - Green Acceptable Threshold: _how it should be..._

---

# How to facilitate discusssions?

 * Think around __value for money__: how much resource allocation is consistent with the needs that described through the indicators? 
 
 * What would likely happen in case of different level of resource? Try to also think of a potential __counterfactual__ (_what could have had happened without intervention_).
 
 * Use the session to confront __perceptions, opinions and facts__. 
 
 * Reflect on potential __missing programmatic evidences__ that could justify evaluative investigations.
 

---

# How to read the "results" charts?

In order to present jointly and compare indicators that have different unit of measurement, __relative distances__ are computed in order to provide a ways to cross-analyse indicators across different outcomes:  

   - __Gap__: (Standard Acceptable Green Threshold Value - Actual Value) / Threshold
   - __Progress__: Actual Value vs Baseline Value) / Baseline Value
   - __Deviation__: (Actual Value - Targeted Value) / Targeted Value

Negative "__distance values__" indicate that the actual values is either below the standard, below the target or below the baseline. The interpretation of a negative value depends on the context and should be interpreted in relation with resources allocation. Consistent, recurrent resource allocation in one area should treat negative distance value unless we can prove it would be a lot worth without such investment...

---

# Population statistics

__Framing questions for strategic reflections:__

* What are the main drivers behind significant changes in the number of forcibly displaced and stateless people?

* Are Refugee Status Determination processing in line with needs?

* What are the prospect for Refugee Solutions?


---


```{r popstat, ph=officer::ph_location_fullsize()} 

## Need to account for MCO... - if MCO - then mutliple country to aggregate...

# Piping from previous steps
fd_last_ten_years <- refugees::population |>
  dplyr::filter(year >= 2013 & year <= 2023 & 
                coa_iso ==   countrycode::countrycode(params$ctr_name, origin = 'country.name', destination = 'iso3c')) |>
  dplyr::summarise(refugees = sum(refugees, na.rm = TRUE),
                   asylum_seekers = sum(asylum_seekers, na.rm = TRUE), 
                   oip = sum(oip, na.rm = TRUE),
                   ooc = sum(ooc, na.rm = TRUE), 
                   stateless = sum(stateless, na.rm = TRUE), 
                   idps = sum(idps, na.rm = TRUE), 
                   # by define the key to use for summarise
                   .by = year) |>  
  tidyr::pivot_longer(cols = -year, 
                      names_to = "population_type", 
                      values_to = "total")   |> 
  # Creating new or overwriting variables with mutate 
  dplyr::mutate(
    # with factor we enforce a specific order to be used 
    population_type = forcats::fct_relevel(population_type,
                                             "refugees", "oip", "asylum_seekers", "stateless", "idps", "ooc"), 
    # Now we map this to labels
    pop_type  = dplyr::recode(population_type,
                              refugees="Refugees",
                              asylum_seekers="Asylum-seekers",
                              oip="Other people in need of international protection",
                              stateless="Stateless Persons",
                              idps="Internally displaced person",
                              ooc="Others of Concern to UNHCR")) |>
  # Sorting with arrange
  dplyr::arrange(year, population_type)  |>
  # Renaming existing variables
  dplyr::rename( pop_num = total ) 

cols_poptype <- c("Asylum-seekers" = "#18375F",
                    "Refugees" = "#0072BC",
                    "Other people in need of international protection" = "#EF4A60", 
                    "Others of Concern to UNHCR" = "#999999",
                    "Internally displaced persons" = "#00B398",
                    "Stateless Persons" = "#E1CC0D")

### Pulling last record to populate the title and subtitle
fd_last <- fd_last_ten_years |>
        dplyr::filter(year == max( fd_last_ten_years$year))

tot <- scales::label_number(accuracy = .2, scale_cut = scales::cut_short_scale())(sum( fd_last$pop_num, na.rm = TRUE))


charttit <-  paste0(tot , " People reported through UNHCR Statistics in ",params$ctr_name , " | As of ", max( fd_last_ten_years$year))


chartsub <- paste0(  
  
  dplyr::if_else(fd_last |> 
                   dplyr::filter(population_type== "idps") |> 
                   dplyr::pull(pop_num) > 0, 
                 paste0( "<span style='color:\"#00B398\"'>", 
                          scales::label_number(accuracy = .2, scale_cut = scales::cut_short_scale())(fd_last |>
                                                                dplyr::filter(population_type== "idps") |> 
                                                                  dplyr::pull(pop_num)),
                         " IDPs</span>  "), 
                 paste0("")),
  
  dplyr::if_else(fd_last |> 
                   dplyr::filter(population_type== "refugees") |> 
                   dplyr::pull(pop_num) > 0, 
                 paste0( "<span style='color:\"#0072BC\"'>", 
                          scales::label_number(accuracy = .2, scale_cut = scales::cut_short_scale())(fd_last |>
                                                                dplyr::filter(population_type== "refugees") |> 
                                                                  dplyr::pull(pop_num)),
                         " Refugees</span>  "), 
                 paste0("")),
  
  
  dplyr::if_else(fd_last |> 
                   dplyr::filter(population_type== "asylum_seekers") |> 
                   dplyr::pull(pop_num) > 0, 
                 paste0( "<span style='color:\"#18375F\"'>", 
                          scales::label_number(accuracy = .2, scale_cut = scales::cut_short_scale())(fd_last |>
                                                                dplyr::filter(population_type== "asylum_seekers") |> 
                                                                  dplyr::pull(pop_num)),
                         " Asylum-seekers</span>  "), 
                 paste0("")),
  
  
  dplyr::if_else(fd_last |> 
                   dplyr::filter(population_type== "oip") |> 
                   dplyr::pull(pop_num) > 0, 
                 paste0( "<span style='color:\"#EF4A60\"'>", 
                          scales::label_number(accuracy = .2, scale_cut = scales::cut_short_scale())(fd_last |>
                                                                dplyr::filter(population_type== "oip") |> 
                                                                  dplyr::pull(pop_num)),
                         " Other people in need of international protection</span>  "), 
                 paste0("")),
  
  
  dplyr::if_else(fd_last |> 
                   dplyr::filter(population_type== "stateless") |> 
                   dplyr::pull(pop_num) > 0, 
                 paste0( "<span style='color:\"#E1CC0D\"'>", 
                          scales::label_number(accuracy = .2, scale_cut = scales::cut_short_scale())(fd_last |>
                                                                dplyr::filter(population_type== "stateless") |> 
                                                                  dplyr::pull(pop_num)),
                         " Stateless Persons</span> "), 
                 paste0("")),
  
  
  dplyr::if_else(fd_last |> 
                   dplyr::filter(population_type== "ooc") |> 
                   dplyr::pull(pop_num) > 0, 
                 paste0( "<span style='color:\"#999999\"'>", 
                          scales::label_number(accuracy = .2, scale_cut = scales::cut_short_scale())(fd_last |>
                                                                dplyr::filter(population_type== "ooc") |> 
                                                                  dplyr::pull(pop_num)),
                         " Others of Concern to UNHCR</span> "), 
                 paste0("")),
  
          
         "."
         )


p <- ggplot(data = fd_last_ten_years,
       aes( x =  factor(year),  y = pop_num,
            fill = pop_type)) +  
  geom_col( width = .7 ) + 
  unhcrthemes::scale_fill_unhcr_d(
    palette = "pal_unhcr_poc" ,
    nmax = 9, order = c(4, 1:3, 9, 8)  ) +
      scale_fill_manual(values = cols_poptype,
                      drop = TRUE,
                      limits = force) +
  
  scale_y_continuous(
    expand = expansion(mult = c(0, 0)),
    labels = scales::label_number(scale_cut = scales::cut_short_scale()),
    breaks = scales::pretty_breaks(n = 5)) +
  labs(title = charttit,
       subtitle =  chartsub , 
       caption = "Source: Refugee Data Finder<br>© UNHCR, The UN Refugee Agency")+
  theme_unhcr( grid = "Y", axis = "X", 
               axis_title = FALSE,
               legend = FALSE) 
  
showtext::showtext_auto(FALSE) 
dml(ggobj = p, fonts = list(serif = 'Lato'))
```
  


 
---

# Results & Indicators

__Framing questions for strategic reflections:__

 * What worked well? what did not work? What was learned?

 * How the changes in context affected achievement of results?

 * Which outcome-level results have we made the most progress towards? For which population types?

 * Which outcomes are the least advanced? Are there any population types or locations that are left behind and why?
 



---


```{r show_indicators_outcome_gap, ph=officer::ph_location_fullsize()}

show_indicators(year = 2022,  
            ctr_name = params$ctr_name,
              result_type_name = "Outcome",
             type = "gap"  ) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_indicators_time_outcome_gap, ph=officer::ph_location_fullsize()}
show_indicators_time(year = c(2019,2020, 2021, 2022, 2023), 
            ctr_name = params$ctr_name,
              result_type_name = "Outcome",
             type = "gap"
             ) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))

```

---

```{r show_indicators_outcome_deviation, ph=officer::ph_location_fullsize()}

show_indicators(year = 2022,  
            ctr_name = params$ctr_name,
              result_type_name = "Outcome",
             type = "deviation"  ) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_indicators_time_outcome_deviation, ph=officer::ph_location_fullsize()}
show_indicators_time(year = c(2019,2020, 2021, 2022, 2023), 
            ctr_name = params$ctr_name,
              result_type_name = "Outcome",
             type = "deviation"
             ) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))

```

---

```{r show_indicators_outcome_progress, ph=officer::ph_location_fullsize()}
show_indicators(year = 2022,  
            ctr_name = params$ctr_name,
              result_type_name = "Outcome",
             type = "progress" ) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_indicators_time_outcome_progress, ph=officer::ph_location_fullsize()}
show_indicators_time(year = c(2019,2020, 2021, 2022, 2023), 
            ctr_name = params$ctr_name,
              result_type_name = "Outcome",
             type = "progress"
             ) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```



---


# Resources Allocation  

__Framing questions for strategic reflections:__

 * What are the main changes in regional, political, legal, security, humanitarian space/access, social and economic factors and implications?

 * What are the strategy’s planning assumptions? Shall they be revised? 
 

---


---

```{r show_sectors_oecd, ph=officer::ph_location_fullsize()}
show_sectors(
  year =  c(2020, 2021, 2022), 
  ctr_name = params$ctr_name,
  sector_vocabulary_name = "OECD DAC CRS Purpose Codes (5 digit)") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_sectors_cluster, ph=officer::ph_location_fullsize()}
show_sectors(
  year =  c(2020, 2021, 2022), 
  ctr_name = params$ctr_name,
  sector_vocabulary_name = "Humanitarian Global Clusters (Inter-Agency Standing Committee)") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_sectors_sdg, ph=officer::ph_location_fullsize()}

show_goal_sdg( year =  c( 2020, 2021, 2022),  
  ctr_name = params$ctr_name ) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_sectors_rbm, ph=officer::ph_location_fullsize()}
show_outcome_rbm( year =  c( 2020, 2021, 2022),  
  ctr_name = params$ctr_name ) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```



---


# Resources & Results  

__Framing questions for strategic reflections:__

 * How much the main achievements and results align with Resource Allocation? 
 
 * Can causal links be made between these changes and our interventions?
 
 * Do we need to build counterfactual to justify results?

---

---

```{r show_outcome_result1, ph=officer::ph_location_fullsize()}
show_outcome_result(year =  c(  2020, 2021, 2022), 
             ctr_name = params$ctr_name ,
             outcome = "OA1: Access to Territory, Reg. and Documentation") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "1.1 Proportion of refugees and asylum seekers registered on an individual basis.", 
        outcome = "OA1: Access to Territory, Reg. and Documentation") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "1.2 Proportion of children under 5 years of age whose births have been registered with a civil authority. [SDG 16.9.1 - Tier 1]", 
        outcome = "OA1: Access to Territory, Reg. and Documentation") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```
 

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "1.3 Proportion of PoC with legally recognized identity documents or credentials [GCR 4.2.2].", 
        outcome = "OA1: Access to Territory, Reg. and Documentation") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_outcome_result2, ph=officer::ph_location_fullsize()}
show_outcome_result(year =  c(  2020, 2021, 2022), 
             ctr_name = params$ctr_name ,
             outcome = "OA2: Status Determination") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "2.1 Average processing time (in days) from registration to first instance asylum decision (disaggregated by individual and group procedures).",
        outcome = "OA2: Status Determination") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "2.2 Proportion of individuals undergoing asylum procedures who have access to legal advice or representation.", 
        outcome = "OA2: Status Determination") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "2.3 Proportion of individuals undergoing asylum procedures who have access to an effective appeal mechanism after first instance rejection of their claim.", 
        outcome = "OA2: Status Determination") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```


---

```{r show_outcome_result3, ph=officer::ph_location_fullsize()}
show_outcome_result(year =  c(  2020, 2021, 2022), 
             ctr_name = params$ctr_name ,
             outcome = "OA3: Protection Policy and Law") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "3.1 Extent national legal framework is in line with the 1951 Convention and/or its 1967 Protocol.",
        outcome = "OA3: Protection Policy and Law") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "3.2 Extent national legal framework is in line with the 1961 Convention on the Reduction of Statelessness.", 
        outcome = "OA3: Protection Policy and Law") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```


---

```{r show_outcome_result4, ph=officer::ph_location_fullsize()}
show_outcome_result(year =  c(  2020, 2021, 2022), 
             ctr_name = params$ctr_name ,
             outcome = "OA4: Sexual and Gender-based Violence") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "4.1 Proportion of PoC who know where to access available GBV services",
        outcome = "OA4: Sexual and Gender-based Violence") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "4.2 Proportion of POCs who do not accept violence against women.", 
        outcome = "OA4: Sexual and Gender-based Violence") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "4.3 Proportion of survivors who are satisfied with SGBV case management services.",
        outcome = "OA4: Sexual and Gender-based Violence") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_outcome_result5, ph=officer::ph_location_fullsize()}
show_outcome_result(year =  c(  2020, 2021, 2022), 
             ctr_name = params$ctr_name ,
             outcome = "OA5: Child Protection") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```


---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "5.1 Proportion of children at heightened risk who are supported by a Best Interests Procedure.",
        outcome = "OA5: Child Protection") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "5.2 Proportion of children who participate in community-based child protection programmes",
        outcome = "OA5: Child Protection") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "5.3 Proportion of unaccompanied and separated children who are in an appropriate alternative care arrangement",
        outcome = "OA5: Child Protection") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_outcome_result6, ph=officer::ph_location_fullsize()}

show_outcome_result(year =  c(  2020, 2021, 2022), 
             ctr_name = params$ctr_name ,
             outcome = "OA6: Safety and Access to Justice") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_outcome_result7, ph=officer::ph_location_fullsize()}

show_outcome_result(year =  c(  2020, 2021, 2022), 
             ctr_name = params$ctr_name ,
             outcome = "OA7: Community Engagement and Women's Empowerment") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "7.1 Proportion of PoC who participate meaningfully across all phases of the OMC.", 
        outcome = "OA7: Community Engagement and Women's Empowerment") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "7.2 Proportion of PoC who have access to effective feedback and response mechanisms.", 
        outcome = "OA7: Community Engagement and Women's Empowerment") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "7.3 Proportion (and number) of active female participants on leadership/management structures.",
        outcome = "OA7: Community Engagement and Women's Empowerment") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_outcome_result8, ph=officer::ph_location_fullsize()}

show_outcome_result(year =  c(  2020, 2021, 2022), 
             ctr_name = params$ctr_name ,
             outcome = "OA8: Well-Being and Basic Needs") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "8.1 Proportion of PoC in need that receive cash transfers or in-kind assistance.",
        outcome = "OA8: Well-Being and Basic Needs") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "8.2 Proportion of PoC with primary reliance on clean (cooking) fuels and technology [SDG 7.1.2 Tier 1]", 
        outcome = "OA8: Well-Being and Basic Needs") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_outcome_result9, ph=officer::ph_location_fullsize()}
show_outcome_result(year =  c(  2020, 2021, 2022), 
             ctr_name = params$ctr_name ,
             outcome = "OA9: Sustainable Housing and Settlements") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "9.1 Proportion of PoCs living in habitable and affordable housing.", 
        outcome = "OA9: Sustainable Housing and Settlements") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "9.2 Proportion of PoC that have energy to ensure lighting (close to Sphere).", 
        outcome = "OA9: Sustainable Housing and Settlements") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_outcome_result10, ph=officer::ph_location_fullsize()}

show_outcome_result(year =  c(  2020, 2021, 2022), 
             ctr_name = params$ctr_name ,
             outcome = "OA10: Healthy Lives") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "10.1 Proportion of children aged 9 months to five years who have received measles vaccination.", 
        outcome = "OA10: Healthy Lives") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "10.2. Proportion of births attended by skilled health personnel. [SDG 3.1.2 Tier 1]",
        outcome = "OA10: Healthy Lives") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_outcome_result11, ph=officer::ph_location_fullsize()}

show_outcome_result(year =  c(  2020, 2021, 2022), 
             ctr_name = params$ctr_name ,
             outcome = "OA11: Education") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "11.1 Proportion of PoC enrolled in tertiary and higher education.", 
        outcome = "OA11: Education") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "11.2 Proportion of PoC enrolled in the national education system. [GCR 2.2.1]", 
        outcome = "OA11: Education") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_outcome_result12,  ph=officer::ph_location_fullsize()}
show_outcome_result(year =  c(  2020, 2021, 2022), 
             ctr_name = params$ctr_name ,
             outcome = "OA12: Clean Water, Sanitation and Hygiene") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "12.1 Proportion of PoC using at least basic drinking water services [linked to SDG 6.1.1].", 
        outcome = "OA12: Clean Water, Sanitation and Hygiene") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "12.2 Proportion of PoC with access to a safe household toilet [linked to SDG 6.2.1].", 
        outcome = "OA12: Clean Water, Sanitation and Hygiene") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_outcome_result13, ph=officer::ph_location_fullsize()}
show_outcome_result(year =  c(  2020, 2021, 2022), 
             ctr_name = params$ctr_name ,
             outcome = "OA13: Self Reliance, Economic Inclusion and Livelihoods") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}

compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "13.1. Proportion of PoC with an account at a bank or other financial institution or with a mobile-money-service provider [SDG 8.10.2 Tier 1].", 
        outcome = "OA13: Self Reliance, Economic Inclusion and Livelihoods") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "13.2. Proportion of PoC who self-report positive changes in their income compared to previous year.", 
        outcome = "OA13: Self Reliance, Economic Inclusion and Livelihoods") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "13.3 Proportion of PoC (working age) who are unemployed.",
        outcome = "OA13: Self Reliance, Economic Inclusion and Livelihoods") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```


---

```{r show_outcome_result14,  ph=officer::ph_location_fullsize()}
show_outcome_result(year =  c(  2020, 2021, 2022), 
             ctr_name = params$ctr_name ,
             outcome = "OA14: Voluntary Repatriation and Sustainable Reintegration") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r , ph=officer::ph_location_fullsize()}
compare_resource_result(year =  params$year, 
             ctr_name = params$ctr_name ,
        indicator = "14.1 Proportion of returnees with legally recognized identity documents or credentials [GCR 4.2.2].", 
        outcome = "OA14: Voluntary Repatriation and Sustainable Reintegration") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_outcome_result15, ph=officer::ph_location_fullsize()}

show_outcome_result(year =  c(  2020, 2021, 2022), 
             ctr_name = params$ctr_name ,
             outcome = "OA15: Resettlement and Complementary Pathways") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_outcome_result16, ph=officer::ph_location_fullsize()}

show_outcome_result(year =  c(  2020, 2021, 2022), 
             ctr_name = params$ctr_name ,
             outcome = "OA16: Local Integration and other Local Solutions") -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

 


 
---
 
# Budget & Funding 


__Framing questions for strategic reflections:__

 * How to explain the evolution of your budget vis-a-vis your expenditure?

 * How resilient (or dependent) is the operation in relation with funding sources diversity?



---

```{r show_expenditure, ph=officer::ph_location_fullsize()}
show_expenditure(year = c(2018, 2019,2020, 2021, 2022, 2023),
           ctr_name = params$ctr_name ) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_expenditure_weight, ph=officer::ph_location_fullsize()}
show_expenditure(year = c(2018, 2019,2020, 2021, 2022, 2023),
           ctr_name = params$ctr_name,
             weight_by = c("all")) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_budget_gap, ph=officer::ph_location_fullsize()}
show_budget_gap(year = c(2018, 2019,2020, 2021, 2022, 2023),
           ctr_name = params$ctr_name) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_transaction_flow1, ph=officer::ph_location_fullsize()}
show_transaction_flow(year = 2023, 
                   ctr_name = params$ctr_name) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_transaction_flow2, ph=officer::ph_location_fullsize()}
show_transaction_flow(year = c(2020, 2021, 2022, 2023), 
                   ctr_name = params$ctr_name) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```


---

```{r show_earmarking, ph=officer::ph_location_fullsize()}
show_earmarking(year = c(2018, 2019,2020, 2021, 2022, 2023),
           ctr_name = params$ctr_name) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```


---

```{r show_donors, ph=officer::ph_location_fullsize()}
 
show_donors(year = c(2018, 2019,2020, 2021, 2022, 2023),
           ctr_name = params$ctr_nam,
           transaction_type_name = "Incoming Commitment" )-> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_top_donors1, ph=officer::ph_location_fullsize()}
show_top_donors(year = "2022",
           ctr_name = params$ctr_name,
           top_n = 10) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_top_donors2, ph=officer::ph_location_fullsize()}
show_top_donors(year = "2021",
           ctr_name = params$ctr_name,
           top_n = 10) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_top_donors3, ph=officer::ph_location_fullsize()}
show_top_donors(year = "2020",
           ctr_name = params$ctr_name,
           top_n = 10) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```

---

```{r show_top_donors4, ph=officer::ph_location_fullsize()}
show_top_donors(year = "2019",
           ctr_name = params$ctr_name,
           top_n = 10) -> p
dml(ggobj = p, fonts = list(serif = 'Lato'))
```


---

# Conclusion: An After-Action Review

Organizational learning requires continuous assessment of organisational performance, looking at successes and failures, ensuring that learning takes place to support continuous improvement. At the end of the Strategic moment of Reflection, answer the 3 following set of questions: 

* __Hindsight (looking back)__: What was supposed to happen? What actually happened? What were the differences?

* __Insight (looking broad and deep)__: What worked?  What didn't work? Why didn't it work?

* __Foresight (looking forward) __: What would you do differently next time? Is there any lessons that can be shared with other Operations?

